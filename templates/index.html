<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fintra Hisse Senedi Asistanı</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css', v='1.3') }}">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>Fintra Asistan</span>
                </div>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <i class="fas fa-plus"></i>
                    Yeni Sohbet
                </button>
            </div>
            
            <div class="recent-chats">
                <h3>Son Sohbetler</h3>
                <div class="chat-list" id="chatList">
                    <!-- Sohbet geçmişi buraya dinamik olarak eklenecek -->
                </div>
                <div class="no-chats" id="noChats">
                    <i class="fas fa-comments"></i>
                    <p>Henüz sohbet geçmişi yok</p>
                    <span>Yeni bir sohbet başlatın</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="nav-item" onclick="openSettingsModal()">
                    <i class="fas fa-cog"></i>
                    <span>Ayarlar</span>
                </div>
                <div class="nav-item" onclick="openHelpModal()">
                    <i class="fas fa-question-circle"></i>
                    <span>Yardım</span>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-chat">
            <div class="chat-header">
                <div class="chat-title">
                    <h2>Fintra Hisse Senedi Asistanı</h2>
                    <span class="chat-subtitle">Başlangıç: <script>document.write(new Date().toLocaleDateString('tr-TR'))</script></span>
                </div>
                <div class="chat-actions">
                    <button class="action-btn portfolio-btn" title="Portföy Takip" onclick="openPortfolioModal()">
                        <i class="fas fa-briefcase"></i>
                    </button>
                    <button class="action-btn calendar-btn" title="Finansal Takvim" onclick="openCalendarModal()">
                        <i class="fas fa-calendar-alt"></i>
                    </button>
                    <button class="action-btn alerts-btn" title="Alarmlarım" onclick="openAlertsModal()">
                        <i class="fas fa-bell"></i>
                    </button>
                    <button class="action-btn theme-btn" title="Tema Değiştir" onclick="openThemeModal()">
                        <i class="fas fa-palette"></i>
                    </button>
                    <button class="action-btn" title="Ara" onclick="openSearchModal()">
                        <i class="fas fa-search"></i>
                    </button>
                    <div class="download-dropdown">
                        <button class="action-btn" id="downloadBtn" title="Sohbet Geçmişini İndir" onclick="toggleDownloadDropdown()">
                            <i class="fas fa-download"></i>
                        </button>
                        <div class="download-options" id="downloadOptions">
                            <div class="download-option" onclick="downloadChatHistory('txt')">
                                <i class="fas fa-file-alt"></i>
                                <span>Metin (.txt)</span>
                            </div>
                            <div class="download-option" onclick="downloadChatHistory('json')">
                                <i class="fas fa-file-code"></i>
                                <span>JSON (.json)</span>
                            </div>
                            <div class="download-option" onclick="downloadChatHistory('html')">
                                <i class="fas fa-file-code"></i>
                                <span>HTML (.html)</span>
                            </div>
                        </div>
                    </div>
                    <button class="action-btn" title="Paylaş" onclick="openShareModal()">
                        <i class="fas fa-share"></i>
                    </button>
                    <div class="user-profile">
                        <span>Misafir</span>
                        <div class="avatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Message -->
                <div class="message bot-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="sender-name">Fintra Asistan</span>
                            <span class="message-time"><script>document.write(new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'}))</script></span>
                        </div>
                        <div class="message-text">
                            <h3>Fintra Hisse Senedi Fiyat Tahmini Asistanına Hoş Geldiniz!</h3>
                            <p>Ben yapay zeka destekli bir finans uzmanıyım ve size yardımcı olmak için buradayım.</p>
                            <p>Hisse senedi fiyat tahmini yapmak için aşağıdaki önerilerden birini seçebilir veya kendi sorunuzu yazabilirsiniz.</p>
                            <p><strong>Yeni Özellik:</strong> Finans, yatırım ve ekonomi hakkında her türlü sorunuzu yanıtlayabilirim!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Suggested Prompts -->
            <div class="suggested-prompts" id="suggestedPrompts">
                <button class="prompt-btn" onclick="sendMessage('Fiyat tahmini yap')">
                    <i class="fas fa-chart-line"></i>
                    Fiyat tahmini yap
                </button>
                <button class="prompt-btn" onclick="sendMessage('Teknik analiz yap')">
                    <i class="fas fa-chart-bar"></i>
                    Teknik Analiz
                </button>
                <button class="prompt-btn" onclick="sendMessage('RSI göster')">
                    <i class="fas fa-percentage"></i>
                    RSI Analizi
                </button>
                <button class="prompt-btn" onclick="sendMessage('MACD analizi')">
                    <i class="fas fa-chart-area"></i>
                    MACD Analizi
                </button>
                <button class="prompt-btn" onclick="sendMessage('KCHOL ne olacak?')">
                    <i class="fas fa-question-circle"></i>
                    KCHOL ne olacak?
                </button>
                <button class="prompt-btn" onclick="sendMessage('Yükselir mi?')">
                    <i class="fas fa-arrow-up"></i>
                    Yükselir mi?
                </button>
                <button class="prompt-btn" onclick="sendMessage('Düşer mi?')">
                    <i class="fas fa-arrow-down"></i>
                    Düşer mi?
                </button>
                <button class="prompt-btn" onclick="sendMessage('KCHOL şirketi hakkında bilgi ver')">
                    <i class="fas fa-building"></i>
                    KCHOL Şirketi
                </button>
                <button class="prompt-btn" onclick="sendMessage('Yatırım stratejisi öner')">
                    <i class="fas fa-lightbulb"></i>
                    Yatırım Stratejisi
                </button>
                <button class="prompt-btn" onclick="sendMessage('Ben kısa vadeli yatırımcıyım, RSI ve hacme dikkat etmeliyim')">
                    <i class="fas fa-user-cog"></i>
                    Kişisel Tavsiye
                </button>
                <button class="prompt-btn" onclick="sendMessage('Haber analizi yap')">
                    <i class="fas fa-newspaper"></i>
                    Haber Analizi
                </button>
                <button class="prompt-btn" onclick="openSimulationModal()">
                    <i class="fas fa-calculator"></i>
                    Hisse Simülasyonu
                </button>
                <button class="prompt-btn" onclick="sendMessage('Yardım')">
                    <i class="fas fa-info-circle"></i>
                    Yardım
                </button>
            </div>

            <!-- Message Input -->
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <button class="attachment-btn" title="Dosya Ekle" onclick="openFileUpload()">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="screenshot-btn" title="Ekran Görüntüsü Al" onclick="takeScreenshot()">
                        <i class="fas fa-camera"></i>
                    </button>
                    <input type="text" id="messageInput" placeholder="Mesajınızı yazın veya önerilerden seçin..." onkeypress="handleKeyPress(event)">
                    <button class="voice-btn" id="voiceBtn" title="Ses ile soru sor" onclick="toggleVoiceRecording()">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="send-btn" onclick="sendMessage()" title="Gönder">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <!-- Hidden file input -->
                <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.txt,.doc,.docx" style="display: none;" onchange="handleFileUpload(event)">
                
                <!-- Voice Recording Status -->
                <div class="voice-status" id="voiceStatus" style="display: none;">
                    <div class="voice-indicator">
                        <i class="fas fa-microphone-slash"></i>
                        <span>Ses kaydı durduruldu</span>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Tahmin yapılıyor...</p>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <div class="search-modal-header">
                <h3>Sohbet Geçmişinde Ara</h3>
                <button class="close-btn" onclick="closeSearchModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-input-container">
                <input type="text" id="searchInput" placeholder="Aranacak kelimeyi yazın..." onkeyup="searchMessages(event)">
                <button class="search-btn" onclick="performSearch()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="search-results" id="searchResults">
                <!-- Arama sonuçları buraya gelecek -->
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="share-modal" id="shareModal">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <h3>Paylaşım Seçenekleri</h3>
                <button class="close-btn" onclick="closeShareModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="share-options">
                <div class="share-option" onclick="shareToWhatsApp()">
                    <div class="share-icon whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div class="share-text">
                        <h4>WhatsApp</h4>
                        <p>WhatsApp'ta paylaş</p>
                    </div>
                </div>
                
                <div class="share-option" onclick="shareToTelegram()">
                    <div class="share-icon telegram">
                        <i class="fab fa-telegram"></i>
                    </div>
                    <div class="share-text">
                        <h4>Telegram</h4>
                        <p>Telegram'da paylaş</p>
                    </div>
                </div>
                
                <div class="share-option" onclick="shareToEmail()">
                    <div class="share-icon email">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="share-text">
                        <h4>E-posta</h4>
                        <p>E-posta ile paylaş</p>
                    </div>
                </div>
                
                <div class="share-option" onclick="copyToClipboard()">
                    <div class="share-icon copy">
                        <i class="fas fa-copy"></i>
                    </div>
                    <div class="share-text">
                        <h4>Kopyala</h4>
                        <p>Panoya kopyala</p>
                    </div>
                </div>
                
                <div class="share-option" onclick="shareToTwitter()">
                    <div class="share-icon twitter">
                        <i class="fab fa-twitter"></i>
                    </div>
                    <div class="share-text">
                        <h4>Twitter</h4>
                        <p>Twitter'da paylaş</p>
                    </div>
                </div>
                
                <div class="share-option" onclick="shareToLinkedIn()">
                    <div class="share-icon linkedin">
                        <i class="fab fa-linkedin"></i>
                    </div>
                    <div class="share-text">
                        <h4>LinkedIn</h4>
                        <p>LinkedIn'de paylaş</p>
                    </div>
                </div>
            </div>
            
            <div class="share-preview">
                <h4>Paylaşım Önizlemesi</h4>
                <div class="preview-content" id="sharePreview">
                    <!-- Paylaşım önizlemesi buraya gelecek -->
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Modal -->
    <div class="theme-modal" id="themeModal">
        <div class="theme-modal-content">
            <div class="theme-modal-header">
                <h3>Tema Seçin</h3>
                <button class="close-btn" onclick="closeThemeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="theme-options">
                <div class="theme-option" onclick="changeTheme('light')" id="light-theme">
                    <div class="theme-preview light-preview">
                        <div class="preview-header"></div>
                        <div class="preview-sidebar"></div>
                        <div class="preview-main"></div>
                    </div>
                    <div class="theme-info">
                        <h4>Açık Tema</h4>
                        <p>Parlak ve temiz görünüm</p>
                    </div>
                </div>
                
                <div class="theme-option" onclick="changeTheme('dark')" id="dark-theme">
                    <div class="theme-preview dark-preview">
                        <div class="preview-header"></div>
                        <div class="preview-sidebar"></div>
                        <div class="preview-main"></div>
                    </div>
                    <div class="theme-info">
                        <h4>Koyu Tema</h4>
                        <p>Göz yormayan koyu görünüm</p>
                    </div>
                </div>
                
                <div class="theme-option" onclick="changeTheme('auto')" id="auto-theme">
                    <div class="theme-preview auto-preview">
                        <div class="preview-header"></div>
                        <div class="preview-sidebar"></div>
                        <div class="preview-main"></div>
                    </div>
                    <div class="theme-info">
                        <h4>Otomatik</h4>
                        <p>Sistem ayarlarına göre</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="help-modal" id="helpModal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3>Yardım Merkezi</h3>
                <button class="close-btn" onclick="closeHelpModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="help-content">
                <div class="help-section">
                    <h4><i class="fas fa-rocket"></i> Hızlı Başlangıç</h4>
                    <p> Hisse Senedi Asistanı ile fiyat tahminleri, teknik analizler ve yatırım tavsiyeleri alabilirsiniz.</p>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-comments"></i> Sohbet Özellikleri</h4>
                    <ul>
                        <li><strong>Yeni Sohbet:</strong> Yeni bir konuşma başlatın</li>
                        <li><strong>Sohbet Geçmişi:</strong> Önceki sohbetlerinizi görüntüleyin</li>
                        <li><strong>Mesaj İndirme:</strong> Sohbet geçmişinizi farklı formatlarda indirin</li>
                        <li><strong>Tema Değiştirme:</strong> Açık/koyu tema arasında geçiş yapın</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-chart-line"></i> Önerilen Sorular</h4>
                    <div class="suggested-questions">
                        <button class="help-question" onclick="sendHelpQuestion('Fiyat tahmini yap')">
                            <i class="fas fa-chart-line"></i>
                            Fiyat tahmini yap
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('Teknik analiz yap')">
                            <i class="fas fa-chart-bar"></i>
                            Teknik analiz yap
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('RSI göster')">
                            <i class="fas fa-percentage"></i>
                            RSI Analizi
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('MACD analizi')">
                            <i class="fas fa-chart-area"></i>
                            MACD Analizi
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('KCHOL ne olacak?')">
                            <i class="fas fa-question-circle"></i>
                            KCHOL ne olacak?
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('Yatırım stratejisi öner')">
                            <i class="fas fa-lightbulb"></i>
                            Yatırım Stratejisi
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('KCHOL\'a 6 ay önce 10.000 TL yatırsaydım ne olurdu?')">
                            <i class="fas fa-calculator"></i>
                            KCHOL Simülasyon
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('THYAO\'ya 1 yıl önce 50.000 TL yatırsaydım kaç para kazanırdım?')">
                            <i class="fas fa-chart-pie"></i>
                            THYAO Simülasyon
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('GARAN\'a 6 ay önce 100.000 TL yatırsaydım ne olurdu?')">
                            <i class="fas fa-chart-line"></i>
                            GARAN Simülasyon
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('AKBNK\'ya 1 yıl önce 200.000 TL yatırsaydım kaç para kazanırdım?')">
                            <i class="fas fa-chart-bar"></i>
                            AKBNK Simülasyon
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('Ben kısa vadeli yatırımcıyım, RSI ve hacme dikkat etmeliyim')">
                            <i class="fas fa-user-cog"></i>
                            Kişisel Tavsiye
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('Düşüşte alım yapan strateji için hangi hisseler uygun?')">
                            <i class="fas fa-chart-line"></i>
                            Strateji Önerisi
                        </button>
                        <button class="help-question" onclick="sendHelpQuestion('RSI nedir?')">
                            <i class="fas fa-graduation-cap"></i>
                            RSI Eğitimi
                        </button>
                    </div>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-download"></i> Grafik İndirme</h4>
                    <p>Teknik analiz grafiklerini indirmek için:</p>
                    <ol>
                        <li>Teknik analiz yapın</li>
                        <li>Grafik üzerindeki indirme butonuna tıklayın</li>
                        <li>Veya "Tüm Grafikleri İndir" butonunu kullanın</li>
                    </ol>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-cog"></i> Kısayollar</h4>
                    <div class="shortcuts">
                        <div class="shortcut-item">
                            <kbd>Enter</kbd>
                            <span>Mesaj gönder</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Esc</kbd>
                            <span>Genişletilmiş grafikleri kapat</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl/Cmd + K</kbd>
                            <span>Arama modalını aç</span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-info-circle"></i> Hakkında</h4>
                    <p>Fintra Hisse Senedi Asistanı, yapay zeka destekli bir finans uzmanıdır. KCHOL hisse senedi hakkında fiyat tahminleri, teknik analizler ve yatırım tavsiyeleri sunar.</p>
                    <p><strong>Versiyon:</strong> 1.3.0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-modal-content">
            <div class="settings-modal-header">
                <h3>Ayarlar</h3>
                <button class="close-btn" onclick="closeSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h4><i class="fas fa-palette"></i> Görünüm</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Tema</label>
                            <span>Uygulama temasını değiştirin</span>
                        </div>
                        <button class="setting-btn" onclick="openThemeModal()">
                            <i class="fas fa-palette"></i>
                            Tema Değiştir
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-comments"></i> Sohbet</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Otomatik Kaydetme</label>
                            <span>Sohbet geçmişini otomatik kaydet</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoSave" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Otomatik Kaydırma</label>
                            <span>Yeni mesajlarda otomatik aşağı kaydır</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoScroll" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Önerilen Sorular</label>
                            <span>Sohbet başında önerilen soruları göster</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="showSuggestions" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-microphone"></i> Ses</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Ses Tanıma</label>
                            <span>Mikrofon ile sesli soru sorma</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="voiceRecognition" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Ses Dili</label>
                            <span>Ses tanıma dili</span>
                        </div>
                        <select class="setting-select" id="voiceLanguage">
                            <option value="tr-TR">Türkçe</option>
                            <option value="en-US">İngilizce</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-chart-line"></i> Grafik</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Grafik Kalitesi</label>
                            <span>İndirilen grafiklerin kalitesi</span>
                        </div>
                        <select class="setting-select" id="chartQuality">
                            <option value="1">Düşük (1x)</option>
                            <option value="2" selected>Yüksek (2x)</option>
                            <option value="3">Çok Yüksek (3x)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Grafik Formatı</label>
                            <span>İndirilen grafiklerin formatı</span>
                        </div>
                        <select class="setting-select" id="chartFormat">
                            <option value="png" selected>PNG</option>
                            <option value="jpg">JPG</option>
                            <option value="svg">SVG</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-database"></i> Veri</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Sohbet Geçmişini Temizle</label>
                            <span>Tüm sohbet geçmişini sil</span>
                        </div>
                        <button class="setting-btn danger" onclick="clearAllChats()">
                            <i class="fas fa-trash"></i>
                            Temizle
                        </button>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Ayarları Sıfırla</label>
                            <span>Tüm ayarları varsayılana döndür</span>
                        </div>
                        <button class="setting-btn danger" onclick="resetSettings()">
                            <i class="fas fa-undo"></i>
                            Sıfırla
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-info-circle"></i> Uygulama</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Versiyon</label>
                            <span>Uygulama versiyonu</span>
                        </div>
                        <span class="setting-value">1.3.0</span>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <label>Son Güncelleme</label>
                            <span>Son güncelleme tarihi</span>
                        </div>
                        <span class="setting-value">2024-01-15</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Portföy Takip Modal -->
    <div class="portfolio-modal" id="portfolioModal">
        <div class="portfolio-modal-content">
            <div class="portfolio-modal-header">
                <h3><i class="fas fa-briefcase"></i> Portföy Takip Sistemi</h3>
                <button class="close-btn" onclick="closePortfolioModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="portfolio-content">
                <!-- Portföy Özeti -->
                <div class="portfolio-summary" id="portfolioSummary">
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="card-content">
                                <h4>Toplam Yatırım</h4>
                                <span class="card-value" id="totalInvested">0.00 TL</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="card-content">
                                <h4>Güncel Değer</h4>
                                <span class="card-value" id="currentValue">0.00 TL</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="card-content">
                                <h4>Kar/Zarar</h4>
                                <span class="card-value" id="totalPnl">0.00 TL</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="card-content">
                                <h4>Kar/Zarar %</h4>
                                <span class="card-value" id="totalPnlPercent">0.00%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Portföy Listesi -->
                <div class="portfolio-list">
                    <div class="list-header">
                        <h4><i class="fas fa-list"></i> Portföy Detayları</h4>
                        <button class="add-stock-btn" onclick="showAddStockForm()">
                            <i class="fas fa-plus"></i>
                            Hisse Ekle
                        </button>
                    </div>
                    <div class="portfolio-table" id="portfolioTable">
                        <!-- Portföy tablosu buraya gelecek -->
                    </div>
                </div>

                <!-- Hisse Ekleme Formu -->
                <div class="add-stock-form" id="addStockForm" style="display: none;">
                    <h4><i class="fas fa-plus-circle"></i> Yeni Hisse Ekle</h4>
                    <div class="form-group">
                        <label for="stockSymbol">
                            <i class="fas fa-building"></i>
                            Hisse Kodu
                        </label>
                        <input type="text" id="stockSymbol" placeholder="Örn: KCHOL.IS, THYAO.IS" maxlength="10">
                        <small>Borsa İstanbul hisseleri için .IS ekleyin</small>
                    </div>
                    <div class="form-group">
                        <label for="stockQuantity">
                            <i class="fas fa-sort-numeric-up"></i>
                            Miktar (Adet)
                        </label>
                        <input type="number" id="stockQuantity" placeholder="100" min="1" step="1">
                    </div>
                    <div class="form-group">
                        <label for="stockPrice">
                            <i class="fas fa-lira-sign"></i>
                            Ortalama Alış Fiyatı (TL)
                        </label>
                        <input type="number" id="stockPrice" placeholder="180.50" min="0.01" step="0.01">
                    </div>
                    <div class="form-actions">
                        <button class="form-btn primary" onclick="addStockToPortfolio()">
                            <i class="fas fa-plus"></i>
                            Ekle
                        </button>
                        <button class="form-btn secondary" onclick="hideAddStockForm()">
                            <i class="fas fa-times"></i>
                            İptal
                        </button>
                    </div>
                </div>

                <!-- Portföy Grafiği -->
                <div class="portfolio-chart">
                    <h4><i class="fas fa-chart-pie"></i> Portföy Dağılımı</h4>
                    <div id="portfolioChart" style="height: 300px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Finansal Takvim Modal -->
    <div class="calendar-modal" id="calendarModal">
        <div class="calendar-modal-content">
            <div class="calendar-modal-header">
                <h3><i class="fas fa-calendar-alt"></i> Finansal Takvim</h3>
                <button class="close-btn" onclick="closeCalendarModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="calendar-content">
                <div class="calendar-tabs">
                    <button class="tab-btn active" onclick="switchCalendarTab('overview')">
                        <i class="fas fa-eye"></i>
                        Genel Bakış
                    </button>
                    <button class="tab-btn" onclick="switchCalendarTab('company')">
                        <i class="fas fa-building"></i>
                        Şirket Bazlı
                    </button>
                    <button class="tab-btn" onclick="switchCalendarTab('upcoming')">
                        <i class="fas fa-clock"></i>
                        Yaklaşan Olaylar
                    </button>
                    <button class="tab-btn" onclick="switchCalendarTab('add')">
                        <i class="fas fa-plus"></i>
                        Olay Ekle
                    </button>
                </div>
                
                <!-- Genel Bakış Tab -->
                <div class="tab-content active" id="overviewTab">
                    <div class="calendar-overview">
                        <!-- Scraping Kontrolleri -->
                        <div class="scraping-controls">
                            <div class="control-group">
                                <button class="btn btn-primary" onclick="updateAllCompanies()">
                                    <i class="fas fa-sync-alt"></i>
                                    Tüm Şirketleri Güncelle
                                </button>
                                <button class="btn btn-secondary" onclick="refreshCalendar()">
                                    <i class="fas fa-refresh"></i>
                                    Takvimi Yenile
                                </button>
                            </div>
                            <div class="control-info">
                                <small>Web scraping ile güncel veriler çekilir</small>
                            </div>
                        </div>
                        
                        <!-- Takvim Özeti -->
                        <h4><i class="fas fa-chart-bar"></i> Takvim Özeti</h4>
                        <div class="calendar-summary" id="calendarSummary">
                            <!-- Özet bilgiler buraya gelecek -->
                        </div>
                        
                        <h4><i class="fas fa-chart-pie"></i> Şirket Dağılımı</h4>
                        <div class="company-stats" id="companyStats">
                            <!-- Şirket istatistikleri buraya gelecek -->
                        </div>
                        
                        <h4><i class="fas fa-calendar-check"></i> Tüm Olaylar</h4>
                        <div class="calendar-table" id="calendarTable">
                            <!-- Takvim tablosu buraya gelecek -->
                        </div>
                    </div>
                </div>
                
                <!-- Şirket Bazlı Tab -->
                <div class="tab-content" id="companyTab">
                    <div class="company-selector">
                        <div class="selector-row">
                            <div class="selector-group">
                                <label for="companySelect">
                                    <i class="fas fa-building"></i>
                                    Şirket Seçin
                                </label>
                                <select id="companySelect" onchange="loadCompanyCalendar()">
                                    <option value="">Şirket seçin...</option>
                                </select>
                            </div>
                            <div class="selector-actions">
                                <button class="btn btn-sm btn-primary" id="updateCompanyBtn" onclick="updateSelectedCompany()" style="display: none;">
                                    <i class="fas fa-sync-alt"></i>
                                    Güncelle
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="company-events" id="companyEvents">
                        <!-- Şirket olayları buraya gelecek -->
                    </div>
                </div>
                
                <!-- Yaklaşan Olaylar Tab -->
                <div class="tab-content" id="upcomingTab">
                    <div class="upcoming-controls">
                        <label for="upcomingDays">
                            <i class="fas fa-calendar-day"></i>
                            Gün Sayısı
                        </label>
                        <select id="upcomingDays" onchange="loadUpcomingEvents()">
                            <option value="7">7 gün</option>
                            <option value="30" selected>30 gün</option>
                            <option value="60">60 gün</option>
                            <option value="90">90 gün</option>
                        </select>
                    </div>
                    
                    <div class="upcoming-events" id="upcomingEvents">
                        <!-- Yaklaşan olaylar buraya gelecek -->
                    </div>
                </div>
                
                <!-- Olay Ekleme Tab -->
                <div class="tab-content" id="addTab">
                    <div class="event-form">
                        <div class="form-group">
                            <label for="eventSymbol">
                                <i class="fas fa-building"></i>
                                Şirket Kodu
                            </label>
                            <input type="text" id="eventSymbol" placeholder="Örn: THYAO, KCHOL, GARAN" maxlength="10">
                        </div>
                        
                        <div class="form-group">
                            <label for="eventType">
                                <i class="fas fa-tag"></i>
                                Olay Türü
                            </label>
                            <select id="eventType">
                                <option value="bilanço">Bilanço</option>
                                <option value="genel_kurul">Genel Kurul</option>
                                <option value="temettü">Temettü</option>
                                <option value="diğer">Diğer</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="eventDate">
                                <i class="fas fa-calendar"></i>
                                Tarih
                            </label>
                            <input type="date" id="eventDate">
                        </div>
                        
                        <div class="form-group">
                            <label for="eventDescription">
                                <i class="fas fa-align-left"></i>
                                Açıklama
                            </label>
                            <textarea id="eventDescription" placeholder="Olay açıklaması..." rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="eventSource">
                                <i class="fas fa-link"></i>
                                Kaynak
                            </label>
                            <input type="text" id="eventSource" placeholder="Örn: KAP, Şirket" value="KAP">
                        </div>
                        
                        <div class="form-group">
                            <label for="eventStatus">
                                <i class="fas fa-info-circle"></i>
                                Durum
                            </label>
                            <select id="eventStatus">
                                <option value="bekliyor">Bekliyor</option>
                                <option value="tamamlandı">Tamamlandı</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="form-btn primary" onclick="addCalendarEvent()">
                                <i class="fas fa-plus"></i>
                                Olay Ekle
                            </button>
                            <button class="form-btn secondary" onclick="resetEventForm()">
                                <i class="fas fa-undo"></i>
                                Sıfırla
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="calendar-actions">
                    <button class="action-btn csv-import-btn" onclick="importCalendarCSV()" title="Finansal takvim verilerini CSV dosyasından yükle">
                        <i class="fas fa-upload"></i>
                        <span>CSV Yükle</span>
                    </button>
                    <button class="action-btn csv-export-btn" onclick="exportCalendarCSV()" title="Finansal takvim verilerini CSV dosyası olarak indir">
                        <i class="fas fa-download"></i>
                        <span>CSV İndir</span>
                    </button>
                    <button class="action-btn refresh-btn" onclick="refreshCalendar()" title="Finansal takvimi yenile ve güncel verileri çek">
                        <i class="fas fa-sync"></i>
                        <span>Yenile</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alarmlar Modal -->
    <div class="alerts-modal" id="alertsModal">
        <div class="alerts-modal-content">
            <div class="alerts-modal-header">
                <h3><i class="fas fa-bell"></i> Alarmlarım</h3>
                <button class="close-btn" onclick="closeAlertsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="alerts-content">
                <div class="alerts-tabs">
                    <button class="tab-btn active" onclick="switchAlertsTab('active')">
                        <i class="fas fa-bell"></i>
                        Aktif Alarmlar
                    </button>
                    <button class="tab-btn" onclick="switchAlertsTab('triggered')">
                        <i class="fas fa-check-circle"></i>
                        Tetiklenen Alarmlar
                    </button>
                    <button class="tab-btn" onclick="switchAlertsTab('cancelled')">
                        <i class="fas fa-ban"></i>
                        İptal Edilen Alarmlar
                    </button>
                </div>
                
                <!-- Aktif Alarmlar Tab -->
                <div class="tab-content active" id="activeAlertsTab">
                    <div class="alerts-summary">
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="summary-info">
                                <h4>Aktif Alarmlar</h4>
                                <span id="activeAlertsCount">0</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="summary-info">
                                <h4>Sonraki Alarm</h4>
                                <span id="nextAlertDate">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alerts-list" id="activeAlertsList">
                        <!-- Aktif alarmlar buraya gelecek -->
                    </div>
                </div>
                
                <!-- Tetiklenen Alarmlar Tab -->
                <div class="tab-content" id="triggeredAlertsTab">
                    <div class="alerts-list" id="triggeredAlertsList">
                        <!-- Tetiklenen alarmlar buraya gelecek -->
                    </div>
                </div>
                
                <!-- İptal Edilen Alarmlar Tab -->
                <div class="tab-content" id="cancelledAlertsTab">
                    <div class="alerts-list" id="cancelledAlertsList">
                        <!-- İptal edilen alarmlar buraya gelecek -->
                    </div>
                </div>
                
                <div class="alerts-actions">
                    <button class="action-btn refresh-btn" onclick="refreshAlerts()">
                        <i class="fas fa-sync"></i>
                        Yenile
                    </button>
                    <button class="action-btn csv-export-btn" onclick="exportAlertsCSV()">
                        <i class="fas fa-download"></i>
                        CSV İndir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hisse Simülasyon Modal -->
    <div class="simulation-modal" id="simulationModal">
        <div class="simulation-modal-content">
            <div class="simulation-modal-header">
                <h3><i class="fas fa-calculator"></i> Hisse Senedi Simülasyonu</h3>
                <button class="close-btn" onclick="closeSimulationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="simulation-content">
                <div class="simulation-form">
                    <div class="form-group">
                        <label for="simulationStock">
                            <i class="fas fa-building"></i>
                            Hisse Kodu
                        </label>
                        <input type="text" id="simulationStock" placeholder="Örn: KCHOL.IS, THYAO.IS, GARAN.IS" value="KCHOL.IS">
                        <small>Borsa İstanbul hisseleri için .IS ekleyin (KCHOL.IS)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="simulationDate">
                            <i class="fas fa-calendar"></i>
                            Başlangıç Tarihi
                        </label>
                        <input type="text" id="simulationDate" placeholder="Örn: 6 ay önce, 1 yıl önce, 2023-01-01" value="6 ay önce">
                        <small>Doğal dil ile tarih girebilirsiniz</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="simulationAmount">
                            <i class="fas fa-lira-sign"></i>
                            Yatırım Tutarı (TL)
                        </label>
                        <input type="number" id="simulationAmount" placeholder="Örn: 10000" value="10000" min="100" step="100">
                        <small>Minimum 100 TL</small>
                    </div>
                    
                    <div class="form-actions">
                        <button class="simulation-btn primary" onclick="runSimulation()">
                            <i class="fas fa-play"></i>
                            Simülasyonu Çalıştır
                        </button>
                        <button class="simulation-btn secondary" onclick="resetSimulationForm()">
                            <i class="fas fa-undo"></i>
                            Sıfırla
                        </button>
                    </div>
                </div>
                
                <div class="simulation-examples">
                    <h4><i class="fas fa-lightbulb"></i> Örnek Simülasyonlar</h4>
                    <div class="example-buttons">
                        <button class="example-btn" onclick="loadSimulationExample('KCHOL.IS', '6 ay önce', 10000)">
                            <i class="fas fa-chart-line"></i>
                            KCHOL 6 ay önce 10.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('THYAO.IS', '1 yıl önce', 50000)">
                            <i class="fas fa-plane"></i>
                            THYAO 1 yıl önce 50.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('GARAN.IS', '3 ay önce', 25000)">
                            <i class="fas fa-university"></i>
                            GARAN 3 ay önce 25.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('AKBNK.IS', '2023 başı', 100000)">
                            <i class="fas fa-chart-bar"></i>
                            AKBNK 2023 başı 100.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('ASELS.IS', '1 ay önce', 15000)">
                            <i class="fas fa-rocket"></i>
                            ASELS 1 ay önce 15.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('SASA.IS', '2 ay önce', 30000)">
                            <i class="fas fa-shopping-cart"></i>
                            SASA 2 ay önce 30.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('EREGL.IS', '1 yıl önce', 250000)">
                            <i class="fas fa-industry"></i>
                            EREGL 1 yıl önce 250.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('ISCTR.IS', '6 ay önce', 500000)">
                            <i class="fas fa-university"></i>
                            ISCTR 6 ay önce 500.000 TL
                        </button>
                        <button class="example-btn" onclick="loadSimulationExample('BIMAS.IS', '1 ay önce', 1000000)">
                            <i class="fas fa-store"></i>
                            BIMAS 1 ay önce 1.000.000 TL
                        </button>
                    </div>
                </div>
                
                <div class="simulation-result" id="simulationResult" style="display: none;">
                    <h4><i class="fas fa-chart-pie"></i> Simülasyon Sonucu</h4>
                    <div class="result-content" id="resultContent">
                        <!-- Sonuç buraya gelecek -->
                    </div>
                    <div class="result-actions">
                        <button class="result-btn" onclick="shareSimulationResult()">
                            <i class="fas fa-share"></i>
                            Paylaş
                        </button>
                        <button class="result-btn" onclick="downloadSimulationResult()">
                            <i class="fas fa-download"></i>
                            İndir
                        </button>
                        <button class="result-btn" onclick="runNewSimulation()">
                            <i class="fas fa-plus"></i>
                            Yeni Simülasyon
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/tr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js', v='1.3') }}"></script>
</body>
</html> 